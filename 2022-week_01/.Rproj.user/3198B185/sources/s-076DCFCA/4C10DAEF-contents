---
title: "How Bad is it really"
author: "Simon"
date: "1/9/2022"
output: html_document
---

```{r setup, include=FALSE}
pacman::p_load(tidyverse,viridis,magrittr,wesanderson,cowplot)

knitr::opts_chunk$set(echo = TRUE)


# Blackrock?
Anlagesumme=45467144553
Streumunition_landminen=(0.52/100)*Anlagesumme
Atomwaffen=(0.5/100)*Anlagesumme
ZivileWaffen=(0.23/100)*Anlagesumme
Tabak=(0.62/100)*Anlagesumme
UN_GloablCompactViolation=(0.82/100)*Anlagesumme
Kohle=(0.11/100)*Anlagesumme
Ölsand=(0.24/100)*Anlagesumme

total=Streumunition_landminen+Atomwaffen+ZivileWaffen+Tabak+UN_GloablCompactViolation+Kohle+Ölsand
```

# About

In diesem Script erkunde ich wie groß der Anteil fragwürdiger Unternehmen und Geschäfte im beliebtesten MSCI world ETF ist. 
Der größter MSCI world ETF wird von Blackrock vertrieben und nennt sich iShares Core MSCI World UCITS ETF. 
Alle informationen zum Produkt habe wurde der [Produktbeschreibung von Blackrock entnommen](https://www.ishares.com/de/privatanleger/de/produkte/251882/ishares-msci-world-ucits-etf-acc-fund).
Demnach beträgt sich das gesamtkapital des ETFS auf 47055706319,35 USD. Von diesem Vermögen sind 0.52% in Unternehmen investiert, die umstrittene Waffen wie Landminen oder Splittergranaten produzieren. Das sind `r round(Streumunition_landminen/10^9,3)` Milliarden USD. 0.50% sind in Atomwaffen investiert, `r 47055706319*0.005` USD. Insgesamt sind nach eigenen Angaben`r round(total/10^9,3)` Milliarden USD in Moralisch nicht vertretbare Produkte investiert.


## For scale.

```{r pressure, echo=FALSE}
numextract <- function(string){ 
  str_extract(string, "\\-*\\d+\\.*\\d*")
} 
#opearater that returns true for any value that is not in a list
`%notin%` <- Negate(`%in%`)


GDP<-read.csv("GDPDATA.csv",skip = 4)%>%
  pivot_longer(cols=starts_with("X"),names_to = "Year",values_to = "GDP")%>%
  mutate(GDP=GDP/10^9,Year=as.numeric(numextract(Year)))#show in Billion. (Milliarden)
#There are a couple of wierd cases or summaries in there. Filter them out.

Odd_Cases=read.csv(file ="odd_ones.csv",header=T)%>%filter(Odd_Codes!="LIC" & Odd_Codes!="HPC")
  #leave low income in

GDP%<>%filter(Country.Code %notin% Odd_Cases$Odd_Codes)
```

```{r}
library(wesanderson)
library(RColorBrewer)
Code_breaks=GDP$Country.Code%>%unique()
Colors=rep("grey",length(Code_breaks))
Size=rep(0.5,length(Code_breaks))
Alphas=rep(0.1,length(Code_breaks))

ColourContries=c("ARE","BFA","COG","CHE","DEU","EUU","GRC","IRQ","YEM","LIC","HPC")#which Contries do you want to highlight?
  
Highlights=brewer.pal(n=length(ColourContries),name="Spectral")

legend<-cowplot::get_legend(ggplot(data.frame(ColourContries),aes(x=ColourContries,fill=ColourContries))+
  geom_bar()+scale_fill_manual(name="GPD of",breaks=ColourContries,values=Highlights)
)

#make highlight vectors
Colors[which(Code_breaks %in% ColourContries)]=Highlights
Size[which(Code_breaks %in% ColourContries)]=0.8
Alphas[which(Code_breaks %in% ColourContries)]=1

GDPPlot<-GDP%>%filter(Year>1990)%>%
  ggplot(aes(x=Year,y=GDP))+
  geom_line(aes(color=Country.Code,alpha=Country.Code,size=Country.Code))+
  geom_hline(yintercept=Anlagesumme/10^9,color="blue")+
  geom_hline(yintercept=total/10^9,color="red")+
  scale_y_log10("Country GDP in Billion [logscale]")+
  scale_color_manual(breaks=Code_breaks,values = Colors)+
  scale_size_manual(breaks=Code_breaks,values = Size)+
  scale_alpha_manual(breaks=Code_breaks,values = Alphas)+
  theme_bw()+
  theme(legend.position="none")

```


```{r}
plot_grid(GDPPlot,legend)
```
```{r}
GDP%>%filter(Year>1990)%>%group_by(Country.Code)%>%
  summarize(mGDP=mean(GDP,na.rm=T),
            sem=sd(GDP,na.rm=T)/sqrt(n()))%>%filter(!is.na(mGDP))->GDP2

    #arrange(mGDP)%>%
GDP2$Country.Code=factor(GDP2$Country.Code,levels=GDP2$Country.Code[order(GDP2$mGDP)])

```

#
```{r fig.width=5,fig.height=10}
figure<-GDP2%>%
  ggplot(aes(y=Country.Code,x=mGDP))+
  geom_point()+
  geom_errorbarh(aes(xmin=mGDP-sem,xmax=mGDP+sem))+
  scale_x_log10(name="Country GDP average since 1990 in Billion (sem) [logscale]")+
  geom_vline(xintercept=Anlagesumme/10^9,color="blue")+
  geom_vline(xintercept=total/10^9,color="red")+
  annotate(geom = "text", x = Anlagesumme/10^9-37, y=220, label="Total sum invested",color="blue")+
  annotate(geom = "text", x = (total/10^9)-1.25,y=200, label="Sum invested in morally\nrepugnant buisnesses",color="red")+
  ggtitle("Your favorite Blackrock ETFcompared to Country GDP",subtitle="iShares Core MSCI World UCITS ETF")+
  theme_cowplot(14)+
  theme(axis.text.y=element_text(size=4))

ggsave("fun.png",width = 7,height=10)
```
